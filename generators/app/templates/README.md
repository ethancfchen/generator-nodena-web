# <%= appname %>

> Generated by [nodena-web][npm-url]

## Information

## Runtime

*   [Git][Git]
*   [Node.js][Node.js]
    *   [Gulp][Gulp]
*   Optional Node Packages
    *   [pug-lint][pug-lint]
    *   [sass-lint][sass-lint]
    *   [ESLint][ESLint]

## File Structure

| File/Directory   | Description                                                 |
| ---------------- | ----------------------------------------------------------- |
| `gulp-tasks/`    | [Gulp][Gulp] task definitions                               |
| `config/`        | [Config][node-config] files                                 |
| `src/`           | Source files                                                |
| `src/docs/`      | HTML document sources                                       |
| `src/sass/`      | Stylesheet sources                                          |
| `src/js/`        | Script sources                                              |
| `src/img/`       | Images sources                                              |
| `src/extras/`    | `favicon` and `sitemap.xml` etc.                            |
| `build/`         | Build files for developement/debug                          |
| `dist/`          | Distribution files for online sites                         |
| `docs/`          | [JSDoc][JSDoc] generated files                              |
| `node_modules/`  | Dependent packages for Node.js                              |
| `.editorconfig`  | Editor config file for editors                              |
| `.eslintignore`  | Ignored files list for [ESlint][ESlint]                     |
| `.eslintrc.js`   | Setup file for [ESlint][ESlint]                             |
| `.gitignore`     | Ignored files list for [Git][Git]                           |
| `.pug-lintrc`    | Setup file for [pug-lint][pug-lint]                         |
| `.sass-lint.yml` | Setup file for [sass-lint][sass-lint]                       |
| `gulpfile.js`    | Project main workflow                                       |
| `gulptasks.js`   | Custom task loader for [gulp-task-loader][gulp-task-loader] |
| `package.json`   | Project meta information                                    |
| `README.md`      | This readme file                                            |

## Environment Setup (`config/*`)

See [documents of `node-config`][node-config] for more information.

### root

Default: `(empty)`

Path to destination root, it'll be created if not exist.

Example:

```javascript
module.exports = {
  root: 'cms/',
};
```

### globals

Default: `null`

Define constant variables.

Options:

*   `pug` - Variables will be injected by [`gulp-pug`][gulp-pug] to all [Pug][Pug] files.
*   `sass` - Variables will be injected by [`gulp-preprocess`][gulp-preprocess] to all [Sass][Sass] files.
*   `js` - Variables will be injected by [`gulp-preprocess`][gulp-preprocess] to all JavaScript files.
*   `extras` - Variables will be injected by [`gulp-preprocess`][gulp-preprocess] to all extra files.
    Note: Becareful to process files in extras, it may cause image data failed. Make sure you assign a filter to it.

Example:

```javascript
module.exports = {
  globals: {
    pug: {
      LINK: {
        GOOGLE: 'https://www.google.com/',
      },
    },
    sass: {
      COLOR_BLACK: '#111',
    },
    js: {
      SALT: 'Y3Dhkl4W',
    },
  },
};
```

In [Pug][Pug] files:

```pug
a.link-external(href=LINK.GOOGLE, target="_blank") Google
```

becomes:

```html
<a class="link-external" href="https://www.google.com/" target="_blank">Google</a>
```

In [Sass][Sass] files:

```sass
$color-black: '/* @echo COLOR_BLACK */';
```

becomes:

```sass
$color-black: '#111';
```

In JavaScript files:

```javascript
var salt = '/* @echo SALT */' || 'default value';
```

becomes:

```javascript
var salt = 'Y3Dhkl4W' || 'default value';
```

### preprocess

Default: `null`

Extra settings for [gulp-preprocess][gulp-preprocess].

Options:

*   `filter` - Assign a filter, using [gulp-filter][gulp-filter].
    *   `sass` - Filter on [Sass][Sass] files.
    *   `js` - Filter on JavaScript files.
    *   `extras` - Filter on extra files.

Example:

```javascript
module.exports = {
  preprocess: {
    filter: {
      extras: ['**/*.js'],
    },
  },
};
```

### sass

Setup for [gulp-sass][gulp-sass].

Example:

```javascript
module.exports = {
  sass: {
    outputStyle: 'expanded',
    includePaths: [
      'node_modules/breakpoint-sass/stylesheets',
      'node_modules/normalize-scss/fork-versions/default',
      'node_modules/upport-for/sass',
    ],
  },
};
```

**Warning:** Set `outputStyle` as `'compressed'` will cause
`gulp-preprocess` failed to process conditional block such as `@if/@endif`.

### postcss

Default:

```javascript
module.exports = {
  postcss: {
    cssnext: {},
    gradientfixer: {},
    flexbugsFixes: {},
    mergeLonghand: {},
    mergeRules: {},
    clipPathPolyfill: {},
    cssnano: {
      autoprefixer: false,
    },
  },
};
```

Setup for PostCSS Plugins.

All plugins name will be transformed as `kebab-case` and be loaded with prefix `posecss-`,
see [avaliable plugins][postcss#plugins].

### uglify

Default:

```javascript
module.exports = {
  uglify: {
    output: {
      beautify: false,
      comments: /^\/*!/,
    },
  },
};
```

Setup for [gulp-uglify][gulp-uglify].

Example:

```javascript
module.exports = {
  uglify: {
    mangle: {
      topLevel: true,
    },
    output: {
      beautify: false,
      comments: /^\/*!/,
    },
  },
};
```

### imagemin

Setup for [gulp-imagemin][gulp-imagemin].

*   `main` - Main option for [gulp-imagemin][gulp-imagemin],
    see [avaliable options](https://github.com/sindresorhus/gulp-imagemin#options).
*   `plugins` - Add plugins and its options to [gulp-imagemin][gulp-imagemin].
    All plugins name will be transformed as `kebab-case` and be loaded with prefix `imagemin-`,
    see [avaliable plugins](https://www.npmjs.com/browse/keyword/imageminplugin).

Example:

```javascript
module.exports = {
  imagemin: {
    main: {
      verbose: true,
    },
    plugins: {
      gifsicle: {
        interlaced: true,
      },
      jpegtran: {
        progressive: true,
      },
      optipng: { },
      svgo: { },
    },
  },
}
```

### copy

Copy files from source to destination.

Example:

```javascript
module.exports = {
  copy: [{
    src: "node_modules/webcamjs/webcam.swf",
    dest: "js",
  }, {
    src: [
      "iframe-resizer/js/iframeResizer.contentWindow.min.js",
      "malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js",
    ],
    dest: "js",
  }],
};
```

### robot

Setup for [Robots Generator][robots-generator].

Example:

```javascript
module.exports = {
  robots: {
    allow: ['/'],
    disallow: ['/api/', '/cms/']
  }
};
```

### localServer

Setup for launch a local server.

#### browserSync

Options for [BrowserSync][BrowserSync].

Options:

*   `startPath` - Start path of server. Default: `config.root`.
*   `server.baseDir` - Base directory of server. Default: `config.assets.build`.
*   `server.index` - Default page. Default: `index.html`.
*   `https` - Enable self-signed SSL. Default: `false`.

See [other options of BrowserSync][browser-sync#options].

Example:

```javascript
module.exports = {
  localServer: {
    browserSync: {
      server: {
        index: 'index.php',
      },
      https: true,
    },
  }
};
```

#### proxy

Assign proxies as middleware of [BrowserSync][BrowserSync].

Options:

*   `uri` - The URI path matching for proxy.
*   `options` - The proxy options. See [options of proxy][node-http-proxy#options].

Example:

```javascript
module.exports = {
  localServer: {
    proxy: [{
      uri: '/api',
      options: {
        target: 'https://mydomain.com',
        changeOrigin: true,
        secure: false,
      },
    }, {
      uri: '/upload',
      options: {
        target: 'http://mydomain.com',
        changeOrigin: true,
      },
    }],
  },
};
```

All requests on `/api` will proxy to `https://mydomain.com/api`,
and `/upload` will proxy to `https://mydomain.com/upload`

## [Babel][Babel] Setup ([`.bablerc`](https://babeljs.io/docs/usage/babelrc/))

Create `.babelrc` file on project root to enable [Babel][Babel] on all JavaScripts.

Note that this will also enable the global `strict` mode.

## [webpack][webpack] Setup ([`webpack.config.js`](https://webpack.github.io/docs/configuration.html))

Create `webpack.config.js` on project root to process JavaScript files using [webpack][webpack].

The project config will inject in config file as function argument.

Example: Normal configuration

```javascript
module.exports = {
    // configuration
};
```

Example: Inject with project config

```javascript
var path = require('path');
var webpack = require('webpack');

module.exports = function (config) {
  return {
    devtool: config.isVerbose ? 'inline-source-map' : null,

    // Other settings

    plugins: [
      new webpack.ProvidePlugin({
        $: 'jquery',
        jQuery: 'jquery'
      })
    ].concat(config.isOnline ? [
      new webpack.LoaderOptionsPlugin({
        minimize: true
      }),
      new UglifyJSPlugin({
        sourceMap: config.isVerbose,
        compress: {
          warnings: false
        }
      })
    ] : []);
  };
};
```

## Gulp Tasks

### Build

#### Build for Developement

Build and open live preview with [BrowserSync][BrowserSync].

```bash
NODE_ENV=development gulp
```

#### Build for Stage

Build a distribution for stage, all files will generated in ```dist/stage/```.

```bash
NODE_ENV=stage gulp
```

#### Build for Production

Build a distribution for production, all files will generated in ```dist/production/```

```bash
NODE_ENV=production gulp
```

#### Build Options

##### Verbose (default: false)

Disable all compression and show detailed debug information on console.

```bash
gulp -b
```

##### Port for BrowserSync (default: 8080)

Manually assign the port of live preview.

```bash
gulp -p 8081
```

### Helper

#### Bump New Version

Bump new [semver][semver] version number to `package.json` and create a git tag.

##### Prerelease => 1.0.x-stage.x

```bash
gulp version --new-version prerelease --preid stage
```

##### Patch => 1.0.x

```bash
gulp version --new-version patch
```

##### Minor => 1.x.0

```bash
gulp version --new-version minor
```

##### Major => x.0.0

```bash
gulp version --new-version major
```

##### Manually

```bash
gulp version --new-version 1.2.3
```

### Miscellaneous

#### Save Optimized Images

Copy optimized images of [gulp-imagemin][gulp-imagemin] from distribution folder to source folder.

```bash
NODE_ENV=production gulp save
```

#### Generate JSDoc

Generate [JSDoc][JSDoc] files to ```docs``` folder.

```bash
gulp jsdoc
```

## Change Log

[Changelog](CHANGELOG.md)

[Babel]: https://babeljs.io/
[BrowserSync]: https://www.browsersync.io/
[ESLint]: http://eslint.org/
[Git]: https://git-scm.com/
[Gulp]: http://gulpjs.com/
[JSDoc]: http://usejsdoc.org/
[Node.js]: https://nodejs.org/
[Pug]: http://jade-lang.com/
[Sass]: http://sass-lang.com/
[browser-sync#options]: https://browsersync.io/docs/options
[gulp-filter]: https://github.com/sindresorhus/gulp-filter/
[gulp-imagemin]: https://github.com/sindresorhus/gulp-imagemin/
[gulp-preprocess]: https://github.com/jas/gulp-preprocess/
[gulp-pug]: https://github.com/pugjs/gulp-pug/
[gulp-sass]: https://github.com/dlmanning/gulp-sass/
[gulp-task-loader]: https://github.com/hontas/gulp-task-loader/
[gulp-uglify]: https://github.com/terinjokes/gulp-uglify/
[node-config]: https://github.com/lorenwest/node-config/
[node-http-proxy#options]: https://github.com/nodejitsu/node-http-proxy#options
[npm-url]: https://npmjs.org/package/generator-nodena-web/
[postcss#plugins]: https://github.com/postcss/postcss#plugins/
[pug-lint]: https://github.com/pugjs/pug-lint/
[robots-generator]: https://github.com/haydenbleasel/robots-generator/
[sass-lint]: https://github.com/sasstools/sass-lint/
[semver]: https://github.com/npm/node-semver/
[webpack]: https://webpack.github.io/
