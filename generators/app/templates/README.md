# <%= appname %>

> Generated by [nodena-web][npm-url]

## Information

## Runtime

*   [Git][Git]
*   [Node.js][Node.js]
    *   [Gulp][Gulp]
*   Optional Node Packages
    *   [pug-lint][pug-lint]
    *   [sass-lint][sass-lint]
    *   [ESLint][ESLint]

## File Structure

| File/Directory              | Description                                                 |
|-----------------------------|-------------------------------------------------------------|
| `gulp-tasks/`               | [Gulp][Gulp] task definitions                               |
| `setup/`                    | Project setup helpers                                       |
| `setup/base/`               | Project setup base                                          |
| `setup/base/assets.js`      | Project base assets                                         |
| `setup/base/plugins.js`     | Project base plugin setup details                           |
| `setup/plugins/`            | Project plugin setup details                                |
| `setup/assets.js`           | Extended project assets                                     |
| `setup/plugins.js`          | Extended project plugin setups                              |
| `setup/setup.js`            | Main setup helpers                                          |
| `src/`                      | Source files                                                |
| `src/docs/`                 | HTML document sources                                       |
| `src/sass/`                 | Stylesheet sources                                          |
| `src/js/`                   | Script sources                                              |
| `src/img/`                  | Images sources                                              |
| `src/extras/`               | `favicon` and `sitemap.xml` etc.                            |
| `res/`                      | Resources, including docs, sql, etc.                        |
| `res/changelog.template.md` | Markdown template for changelog                             |
| `dist/`                     | Temporary build files for developement/debug                |
| `docs/`                     | [JSDoc][JSDoc] generated files                              |
| `online/`                   | Files for online sites                                      |
| `online/stage/`             | Files for stage site                                        |
| `online/live/`              | Files for live site                                         |
| `online/patches/`           | Patch files for each version                                |
| `node_modules/`             | Dependent packages for Node.js                              |
| `.editorconfig`             | Editor config file for editors                              |
| `.eslintrc`                 | Setup file for [ESlint][ESlint]                             |
| `.gitignore`                | Ignored files list for [Git][Git]                           |
| `.pug-lintrc`               | Setup file for [pug-lint][pug-lint]                         |
| `.sass-lint.yml`            | Setup file for [sass-lint][sass-lint]                       |
| `gulpfile.js`               | Project main workflow                                       |
| `gulptasks.js`              | Custom task loader for [gulp-task-loader][gulp-task-loader] |
| `package.json`              | Project meta information                                    |
| `setup.json`                | Project setup variables                                     |
| `README.md`                 | This readme file                                            |
| `CHANGELOG.md`              | Auto generated change log                                   |

## Environment Setup (`setup.json`)

### root

Default: `./`

Path to project root, it'll be created if not exist.

Example:

```json
{
  "root": "cms/"
}
```

### server

Options for [BrowserSync][BrowserSync].

Options:

*   `port` - Default port. Default: `8080`.
*   `https` - Enable self-signed SSL. Default: `false`.
*   `index` - Default page. Default: `index.html`.

Example:

```json
{
  "server": {
    "port": 8080,
    "https": true,
    "index": "index.html"
  }
}
```

### proxy

Default: `null`

Assign proxy to [BrowserSync][BrowserSync].

Options:

*   `uri` - The URI path matching for proxy.
*   `options` - The proxy options. See [options of http-proxy-middleware][http-proxy-middleware#options].

Example:

```json
{
  "proxy": [{
    "route": "/api",
    "target": "https://mydomain.com",
    "selfCert": true
  }, {
    "route": "/upload",
    "target": "http://mydomain.com"
  }]
}
```

All requests on `/api` will proxy to `https://mydomain.com/api`,
and `/upload` will proxy to `https://mydomain.com/upload`

### globals

Default: `null`

Define constant variables.

Options:

*   `pug` - Variables will be injected by [`gulp-pug`][gulp-pug] to all [Pug][Pug] files.
*   `sass` - Variables will be injected by [`gulp-preprocess`][gulp-preprocess] to all [Sass][Sass] files.
*   `js` - Variables will be injected by [`gulp-preprocess`][gulp-preprocess] to all JavaScript files.
*   `extras` - Variables will be injected by [`gulp-preprocess`][gulp-preprocess] to all extra files.
    Note: Becareful to process files in extras, it may cause image data failed. Make sure you assign a filter to it.

Example:

```json
{
  "globals": {
    "pug": {
      "LINK": {
        "GOOGLE": "https://www.google.com/"
      }
    },
    "sass": {
      "COLOR_BLACK": "#111"
    },
    "js": {
      "SALT": "Y3Dhkl4W"
    }
  }
}
```

In [Pug][Pug] files:

```pug
a.link-external(href=LINK.GOOGLE, target="_blank") Google
```

becomes:

```html
<a class="link-external" href="https://www.google.com/" target="_blank">Google</a>
```

In [Sass][Sass] files:

```sass
$color-black: '/* @echo COLOR_BLACK */';
```

becomes:

```sass
$color-black: '#111';
```

In JavaScript files:

```javascript
var salt = '/* @echo SALT */' || 'default value';
```

becomes:

```javascript
var salt = 'Y3Dhkl4W' || 'default value';
```

### preprocess

Default: `null`

Extra settings for [gulp-preprocess][gulp-preprocess].

Options:

*   `filter` - Assign a filter, using [gulp-filter][gulp-filter].
    *   `sass` - Filter on [Sass][Sass] files.
    *   `js` - Filter on JavaScript files.
    *   `extras` - Filter on extra files.

Example:

```json
{
  "preprocess": {
    "filter": {
      "extras": ["**/*.js"]
    }
  }
}
```

#### sass

Setup for [gulp-sass][gulp-sass].

Example:

```json
{
  "sass": {
    "includePaths": [
      "node_modules/breakpoint-sass/stylesheets",
      "node_modules/normalize-scss/fork-versions/default",
      "node_modules/upport-for/sass"
    ]
  }
}
```

### doiuse

Default: `false`

Setup for [doiuse][doiuse].

Example:

```json
{
  "doiuse": {
    "browsers": [
      "last 2 version",
      "> 5%",
      "ie >= 10"
    ]
  }
}
```

### modernizr

Default: `false`

Customize build options for [Modernizr][Modernizr].

Set 'false' to disable.

Example:

```json
{
  "modernizr": {
    "options" : [
      "setClasses",
      "addTest",
      "html5printshiv",
      "testProp",
      "fnBind"
    ]
  }
}
```

```json
{
  "modernizr": false
}
```

### imagemin

Setup for [gulp-imagemin][gulp-imagemin].

*   `main` - Main option for [gulp-imagemin][gulp-imagemin],
    see [avaliable options](https://github.com/sindresorhus/gulp-imagemin#options).
*   `plugins` - Add plugins and its options to [gulp-imagemin][gulp-imagemin].
    All plugins name will be transfored as `kebab-case` and be loaded with prefix `imagemin-`,
    see [avaliable plugins](https://www.npmjs.com/browse/keyword/imageminplugin).

Example:

```json
{
  "imagemin": {
    "main": {
      "verbose": true
    },
    "plugins": {
      "gifsicle": {
        "interlaced": true
      },
      "jpegtran": {
        "progressive": true
      },
      "optipng": { },
      "svgo": { },
      "giflossy": {
        "interlaced": true
      },
      "jpegrecompress": {
        "progressive": true
      },
      "jpegoptim": {
        "progressive": true
      },
      "mozjpeg": {
        "progressive": true
      },
      "advpng": { },
      "pngcrush": {
        "reduce": true
      },
      "pngout": { },
      "pngquant": { },
      "zopfli": {
        "more": true
      }
    }
  }
}
```

#### copy

Copy files from source to destination.

Example:

```json
{
  "copy": [{
    "src": "node_modules/webcamjs/webcam.swf",
    "dest": "js"
  }, {
    "src": [
      "iframe-resizer/js/iframeResizer.contentWindow.min.js",
      "malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"
    ],
    "dest": "js"
  }]
}
```

### robot

Setup for [Robots Generator][robots-generator].

Example:

```json
{
  "robots": {
    "allow": ["/"],
    "disallow": ["/api/", "/cms/"]
  }
}
```

### Environment Variable

Override constants for different environments.

Avaliable: `local`, `bypass`, `stage`, `live`.

Options:

*   `domain` - The domain of the site.
*   `proxy` - Override `proxy` options.
*   `globals` - Override `globals` variables.

Example:

```json
{
  "stage": {
    "domain": "http://www.stage.com",
    "globals": {
      "pug": {
        "VENDOR": {
          "FB": "123456789"
        }
      }
    }
  },
  "live": {
    "domain": "https://www.live.com",
    "globals": {
      "pug": {
        "VENDOR": {
          "FB": "987654321"
        }
      }
    }
  }
}
```

## [Babel][Babel] Setup ([`.bablerc`](https://babeljs.io/docs/usage/babelrc/))

Create `.babelrc` file on project root to enable [Babel][Babel] on all JavaScripts.

Note that this will also enable the global `strict` mode.

## [webpack][webpack] Setup ([`webpack.config.js`](https://webpack.github.io/docs/configuration.html))

Create `webpack.config.js` on project root to process JavaScript files using [webpack][webpack].

The project setup helper will inject in config file as function argument.

Example: Normal configuration

```javascript
module.exports = {
    // configuration
};
```

Example: Inject with project setup helper

```javascript
var path = require('path');
var webpack = require('webpack');

module.exports = function (setup) {
  return {
    devtool: setup.isVerbose ? 'inline-source-map' : null,

    // Other settings

    plugins: [
      new webpack.ProvidePlugin({
        $: 'jquery',
        jQuery: 'jquery'
      })
    ].concat(setup.isOnline ? [
      new webpack.LoaderOptionsPlugin({
        minimize: true
      }),
      new UglifyJSPlugin({
        sourceMap: setup.isVerbose,
        compress: {
          warnings: false
        }
      })
    ] : []);
  };
};
```

## Gulp Tasks

### Build/Publish

#### Build For Developement

Build the website and open live preview with [BrowserSync][BrowserSync].

```bash
gulp
```

#### Build For Test/Debug in Published Environment (Bypass)

Build the website and open live preview with [BrowserSync][BrowserSync].

```bash
gulp bypass
```

#### Publish For Stage Site

Build the website for stage, all files will generated in ```online/stage/```
and create a version patch to ```online/patches/<version>```.

```bash
gulp stage
```

#### Publish For Live Site

Build the website for stage, all files will generated in ```online/live/```
and create a version patch to ```online/patches/<version>```.

```bash
gulp live
```

#### Build Options

##### Verbose (default: false)

Disable all compression and show detailed debug information on console.

```bash
gulp -b
```

##### Version (default: prerelease/patch)

Increace version number using [semver][semver].

###### Prerelease (Only for stage) => 1.0.x-stage.x

```bash
gulp stage
```

###### Patch (Only for live)

```bash
gulp live
```

###### Minor (Only for live) => 1.x.0

```bash
gulp live -v minor
```

###### Major (Only for live) => x.0.0

```bash
gulp live -v major
```

###### Manually (Only for live)

```bash
gulp live -v 1.0.1
```

##### Port for BrowserSync (default: 8080)

Manually assign the port of live preview.

```bash
gulp -p 8081
```

### Miscellaneous

#### Save Optimized Images

Copy optimized images of [gulp-imagemin][gulp-imagemin] from destination folder to source folder.

```bash
gulp save
```

#### Generate JSDoc

Generate [JSDoc][JSDoc] files to ```docs``` folder.

```bash
gulp jsdoc
```

## Change Log

[Changelog](CHANGELOG.md)

[Babel]: https://babeljs.io/
[BrowserSync]: https://www.browsersync.io/
[ESLint]: http://eslint.org/
[Git]: https://git-scm.com/
[Gulp]: http://gulpjs.com/
[JSDoc]: http://usejsdoc.org/
[Modernizr]: https://modernizr.com/
[Node.js]: https://nodejs.org/
[Pug]: http://jade-lang.com/
[Sass]: http://sass-lang.com/
[doiuse]: https://github.com/anandthakker/doiuse/
[gulp-filter]: https://github.com/sindresorhus/gulp-filter/
[gulp-imagemin]: https://github.com/sindresorhus/gulp-imagemin/
[gulp-preprocess]: https://github.com/jas/gulp-preprocess/
[gulp-pug]: https://github.com/pugjs/gulp-pug/
[gulp-sass]: https://github.com/dlmanning/gulp-sass/
[gulp-task-loader]: https://github.com/hontas/gulp-task-loader/
[http-proxy-middleware#options]: https://github.com/nodejitsu/node-http-proxy#options
[npm-url]: https://npmjs.org/package/generator-nodena-web/
[pug-lint]: https://github.com/pugjs/pug-lint/
[robots-generator]: https://github.com/haydenbleasel/robots-generator/
[sass-lint]: https://github.com/sasstools/sass-lint/
[semver]: https://github.com/npm/node-semver/
[webpack]: https://webpack.github.io/
